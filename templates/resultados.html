<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultados del Estudiante</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/resultados.css') }}">
</head>
<body>

  {% include 'navbar.html' %}

  <!-- Contenedor -->
  <div class="container mt-5 pt-5">
    <h1 class="text-center">Resultados del Estudiante</h1>

    <!-- Sección de resumen de respuestas -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">
        <h3 class="mb-0">Resumen de tus respuestas:</h3>
      </div>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Comprensión en clase:</strong> {{ comprension }}</li>
        <li class="list-group-item"><strong>Emoción al ir a la escuela:</strong> {{ emocion_general }}</li>
        <li class="list-group-item"><strong>Frecuencia de estrés por estudios:</strong> {{ estres_estudios }}</li>
        <li class="list-group-item"><strong>Apoyo familiar:</strong> {{ apoyo_familiar }}</li>
        <li class="list-group-item"><strong>¿Tiene amistades en la escuela?:</strong> {{ amistades_escuela }}</li>
        <li class="list-group-item"><strong>Relación con profesores:</strong> {{ relacion_profesores }}</li>
        <li class="list-group-item"><strong>Responsabilidades fuera de la escuela:</strong> {{ responsabilidades }}</li>
        <li class="list-group-item"><strong>Valor que da a lo que aprende:</strong> {{ valor_educacion }}</li>
        <li class="list-group-item"><strong>Probabilidad de terminar el ciclo escolar:</strong> {{ probabilidad_terminar }}</li>
      </ul>
    </div>

    <!-- Sección de evaluación del modelo -->
    <div class="card mb-4">
      <div class="card-header bg-info text-white">
        <h3 class="mb-0">Evaluación del modelo:</h3>
      </div>
      <div class="card-body">
        {% if error %}
          <div class="alert alert-danger">{{ error }}</div>
        {% else %}
          <div class="mb-3">
            <h5>Probabilidad de abandono: 
              {% if probabilidad_abandono != 'N/A' %}
                <span class="badge bg-{{ 'danger' if probabilidad_abandono|float > 50 else 'warning' }}">
                  {{ probabilidad_abandono }}%
                </span>
              {% else %}
                <span class="badge bg-secondary">No disponible</span>
              {% endif %}
            </h5>
            {% if probabilidad_abandono != 'N/A' %}
            <div class="progress">
              <div class="progress-bar progress-bar-striped bg-{{ 'danger' if probabilidad_abandono|float > 50 else 'warning' }}" 
                   role="progressbar" 
                    
                   aria-valuenow="{{ probabilidad_abandono }}" 
                   aria-valuemin="0" 
                   aria-valuemax="100">
              </div>
            </div>
            {% endif %}
          </div>

          <div class="alert alert-{{ 'danger' if riesgo_alto else 'success' }}">
            <h5 class="alert-heading">Diagnóstico:</h5>
            <p class="mb-0">
              {{ motivo_principal }} 
              {% if confianza_principal != 'N/A' %}
                <span class="badge bg-secondary">{{ confianza_principal }}% de confianza</span>
              {% endif %}
            </p>
            {% if riesgo_alto %}
              <hr>
              <p class="mb-0">⚠️ <strong>Alerta:</strong> Alto riesgo de abandono escolar detectado</p>
            {% endif %}
          </div>

          {% if motivos_secundarios %}
          <div class="mt-3">
            <h5>Otras posibles causas:</h5>
            <ul class="list-group">
              {% for motivo, confianza in motivos_secundarios %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ motivo }}
                <span class="badge bg-primary rounded-pill">{{ confianza }}%</span>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
        {% endif %}
      </div>
    </div>

    <!-- Visualización gráfica -->
    <div class="card mb-4">
      <div class="card-header bg-success text-white">
        <h3 class="mb-0">Visualización gráfica</h3>
      </div>
      <div class="card-body">
        <canvas id="graficoResultados" width="400" height="250"></canvas>
      </div>
    </div>

    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
      <a href="{{ url_for('formulario') }}" class="btn btn-primary me-md-2">← Volver al formulario</a>
      <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">Ver estadísticas generales</a>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Chart.js lógica -->
  <script>
    const ctx = document.getElementById('graficoResultados').getContext('2d');
    const chartData = {
      labels: ['Comprensión', 'Estrés', 'Apoyo', 'Profesores', 'Terminar'],
      datasets: [{
        label: 'Indicadores clave (1-5)',
        data: [
          Number("{{ comprension }}"),
          Number("{{ estres_estudios }}"),
          Number("{{ apoyo_familiar }}"),
          Number("{{ relacion_profesores }}"),
          Number("{{ probabilidad_terminar }}")
        ],
        backgroundColor: [
          'rgba(75, 192, 192, 0.5)',
          'rgba(255, 159, 64, 0.5)',
          'rgba(54, 162, 235, 0.5)',
          'rgba(153, 102, 255, 0.5)',
          'rgba(255, 99, 132, 0.5)'
        ],
        borderColor: [
          'rgba(75, 192, 192, 1)',
          'rgba(255, 159, 64, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(153, 102, 255, 1)',
          'rgba(255, 99, 132, 1)'
        ],
        borderWidth: 1,
        pointBackgroundColor: [
          'rgba(75, 192, 192, 1)',
          'rgba(255, 159, 64, 1)',
          'rgba(54, 162, 235, 1)',
          'rgba(153, 102, 255, 1)',
          'rgba(255, 99, 132, 1)'
        ],
        pointRadius: 4
      }]
    };

    new Chart(ctx, {
      type: 'radar',
      data: chartData,
      options: {
        scales: {
          r: {
            angleLines: { display: true },
            suggestedMin: 0,
            suggestedMax: 5,
            ticks: { 
              stepSize: 1,
              backdropColor: 'rgba(0, 0, 0, 0.1)'
            },
            grid: { color: 'rgba(0, 0, 0, 0.1)' }
          }
        },
        plugins: {
          legend: { 
            position: 'top',
            labels: { font: { size: 12 } }
          },
          tooltip: { 
            callbacks: { 
              label: ctx => ` ${ctx.dataset.label}: ${ctx.raw}/5`,
              title: items => items[0].label
            } 
          }
        },
        elements: {
          line: { tension: 0.1 }
        }
      }
    });
  </script>
</body>
</html>